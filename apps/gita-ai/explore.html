<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#FDFBF7">
    <title>Verse Explorer - Krishna Vaani</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Google+Sans+Flex:wght@400;500;600;700&family=Tiro+Devanagari+Sanskrit:ital@0;1&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="style.css">

    <style>
        /* ============================================
           EXPLORER PAGE - M3 Design
           ============================================ */
        .explore-container {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-sm);
        }

        .search-box {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            background: var(--md-sys-color-surface-container-lowest);
            border: 1px solid var(--md-sys-color-outline);
            border-radius: var(--md-sys-shape-corner-medium);
            padding: var(--space-sm);
            margin-bottom: var(--space-md);
            transition: all var(--md-sys-motion-duration-short) var(--md-sys-motion-easing-standard);
        }

        .search-box:focus-within {
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 3px rgba(232, 93, 4, 0.1);
        }

        .search-box input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: var(--md-sys-typescale-body-large);
            font-family: var(--font-main);
        }

        .search-box input::placeholder {
            color: var(--text-muted);
        }

        .search-box input:focus {
            outline: none;
        }

        .search-box svg {
            color: var(--text-muted);
            width: 20px;
            height: 20px;
        }

        .tabs {
            display: flex;
            gap: var(--space-xs);
            margin-bottom: var(--space-md);
            overflow-x: auto;
            padding-bottom: 4px;
        }

        .tab {
            padding: var(--space-xs) var(--space-sm);
            background: var(--md-sys-color-surface-container);
            border: 1px solid var(--md-sys-color-outline-variant);
            border-radius: var(--md-sys-shape-corner-full);
            color: var(--text-secondary);
            font-size: var(--md-sys-typescale-label-large);
            font-weight: 500;
            white-space: nowrap;
            cursor: pointer;
            transition: all var(--md-sys-motion-duration-short) var(--md-sys-motion-easing-standard);
        }

        .tab:hover {
            background: var(--md-sys-color-surface-container-high);
        }

        .tab.active {
            background: var(--md-sys-color-primary);
            border-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
        }

        .chapter-card {
            background: var(--md-sys-color-surface-container-lowest);
            border: 1px solid var(--md-sys-color-outline-variant);
            border-radius: var(--md-sys-shape-corner-large);
            padding: var(--space-sm);
            margin-bottom: var(--space-sm);
            cursor: pointer;
            transition: all var(--md-sys-motion-duration-short) var(--md-sys-motion-easing-standard);
        }

        .chapter-card:hover {
            border-color: var(--md-sys-color-primary);
            box-shadow: var(--shadow-hover);
            transform: translateX(4px);
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-xs);
        }

        .chapter-number {
            font-size: var(--md-sys-typescale-label-small);
            color: var(--md-sys-color-primary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .chapter-name {
            font-family: var(--font-sanskrit);
            font-size: 1.3rem;
            color: var(--text-primary);
            margin: 4px 0;
        }

        .chapter-name-en {
            font-size: var(--md-sys-typescale-body-medium);
            color: var(--text-secondary);
        }

        .chapter-meta {
            font-size: var(--md-sys-typescale-body-small);
            color: var(--text-muted);
            display: flex;
            gap: var(--space-sm);
            margin-top: var(--space-xs);
        }

        .verses-list {
            display: none;
        }

        .verses-list.active {
            display: block;
        }

        .verse-item {
            background: var(--md-sys-color-surface-container-lowest);
            border: 1px solid var(--md-sys-color-outline-variant);
            border-radius: var(--md-sys-shape-corner-medium);
            padding: var(--space-sm);
            margin-bottom: var(--space-sm);
        }

        .verse-ref {
            font-size: var(--md-sys-typescale-label-medium);
            color: var(--md-sys-color-primary);
            font-weight: 600;
            margin-bottom: var(--space-xs);
        }

        .verse-sanskrit-text {
            font-family: var(--font-sanskrit);
            font-size: 1.1rem;
            color: var(--md-sys-color-primary);
            line-height: 1.7;
            margin-bottom: var(--space-xs);
        }

        .verse-translation-text {
            font-size: var(--md-sys-typescale-body-large);
            color: var(--text-primary);
            line-height: 1.6;
            margin-bottom: var(--space-xs);
        }

        .verse-explanation {
            font-size: var(--md-sys-typescale-body-medium);
            color: var(--text-secondary);
            line-height: 1.5;
            padding-left: var(--space-sm);
            border-left: 2px solid var(--md-sys-color-primary);
        }

        .verse-themes {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: var(--space-sm);
        }

        .theme-tag {
            padding: 4px 10px;
            background: var(--md-sys-color-primary-container);
            border-radius: var(--md-sys-shape-corner-full);
            font-size: var(--md-sys-typescale-label-small);
            color: var(--md-sys-color-primary);
            text-transform: capitalize;
            font-weight: 500;
        }

        .back-to-chapters {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            color: var(--text-secondary);
            font-size: var(--md-sys-typescale-body-medium);
            margin-bottom: var(--space-sm);
            cursor: pointer;
            transition: color var(--md-sys-motion-duration-short) var(--md-sys-motion-easing-standard);
        }

        .back-to-chapters svg {
            width: 18px;
            height: 18px;
        }

        .back-to-chapters:hover {
            color: var(--md-sys-color-primary);
        }

        .empty-state {
            text-align: center;
            padding: var(--space-xl) var(--space-md);
            color: var(--text-muted);
        }

        .empty-state svg {
            width: 48px;
            height: 48px;
            margin-bottom: var(--space-sm);
            opacity: 0.5;
        }

        .daily-wisdom {
            background: var(--md-sys-color-primary-container);
            border: 1px solid rgba(232, 93, 4, 0.2);
            border-radius: var(--md-sys-shape-corner-large);
            padding: var(--space-md);
            margin-bottom: var(--space-md);
            text-align: center;
        }

        .daily-label {
            font-size: var(--md-sys-typescale-label-medium);
            color: var(--md-sys-color-primary);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: var(--space-sm);
            font-weight: 600;
        }

        .daily-verse {
            font-family: var(--font-sanskrit);
            font-size: 1.2rem;
            color: var(--text-primary);
            line-height: 1.6;
            margin-bottom: var(--space-sm);
        }

        .daily-translation {
            font-size: var(--md-sys-typescale-body-medium);
            color: var(--text-secondary);
            font-style: italic;
        }

        .daily-ref {
            font-size: var(--md-sys-typescale-body-small);
            color: var(--md-sys-color-primary);
            margin-top: var(--space-xs);
            font-weight: 500;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <a href="index.html" class="header-btn back-btn" aria-label="Back">
                <i data-lucide="chevron-left"></i>
            </a>
            <div class="header-center">
                <h1 class="header-title">‡§∂‡•ç‡§≤‡•ã‡§ï ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π</h1>
                <p class="header-subtitle">Verse Explorer</p>
            </div>
            <a href="index.html" class="header-btn" aria-label="Chat">
                <i data-lucide="message-circle"></i>
            </a>
        </header>

        <!-- Explorer Content -->
        <main class="explore-container">
            <!-- Search -->
            <div class="search-box">
                <i data-lucide="search"></i>
                <input type="text" id="search-input" placeholder="Search verses by keyword...">
            </div>

            <!-- Daily Wisdom -->
            <div class="daily-wisdom" id="daily-wisdom">
                <div class="daily-label">‚ú® Today's Wisdom</div>
                <div class="daily-verse" id="daily-verse-text"></div>
                <div class="daily-translation" id="daily-translation-text"></div>
                <div class="daily-ref" id="daily-ref-text"></div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" data-view="chapters">All Chapters</button>
                <button class="tab" data-view="favorites">‚ù§Ô∏è Favorites</button>
            </div>

            <!-- Chapters List -->
            <div id="chapters-list" class="chapters-list">
                <!-- Populated by JS -->
            </div>

            <!-- Verses List (hidden initially) -->
            <div id="verses-list" class="verses-list">
                <div class="back-to-chapters" id="back-btn">
                    <i data-lucide="arrow-left"></i>
                    <span>All Chapters</span>
                </div>
                <div id="verses-content">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Search Results -->
            <div id="search-results" style="display: none;">
                <!-- Populated by JS -->
            </div>
        </main>
    </div>

    <script src="js/gita-data.js"></script>
    <script>
        lucide.createIcons();

        // DOM Elements
        const chaptersListEl = document.getElementById('chapters-list');
        const versesListEl = document.getElementById('verses-list');
        const versesContentEl = document.getElementById('verses-content');
        const searchInput = document.getElementById('search-input');
        const searchResults = document.getElementById('search-results');
        const backBtn = document.getElementById('back-btn');
        const tabs = document.querySelectorAll('.tab');

        // Show daily wisdom
        function showDailyWisdom() {
            const verse = GITA_DATA.getRandomVerse();
            if (verse) {
                document.getElementById('daily-verse-text').textContent = verse.sanskrit.split('\n')[0];
                document.getElementById('daily-translation-text').textContent = `"${verse.translation}"`;
                document.getElementById('daily-ref-text').textContent = `‚Äî Bhagavad Gita ${verse.ref}`;
            }
        }

        // Render chapters list
        function renderChapters() {
            const chapters = GITA_DATA.getChapters();
            chaptersListEl.innerHTML = chapters.map(ch => `
                <div class="chapter-card" data-chapter="${ch.chapter}">
                    <div class="chapter-header">
                        <div>
                            <div class="chapter-number">Chapter ${ch.chapter}</div>
                            <div class="chapter-name">${ch.title}</div>
                            <div class="chapter-name-en">${ch.titleEnglish}</div>
                        </div>
                    </div>
                    <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 8px;">${ch.summary}</p>
                    <div class="chapter-meta">
                        <span>üìñ ${ch.verseCount} verses available</span>
                    </div>
                </div>
            `).join('');

            document.querySelectorAll('.chapter-card').forEach(card => {
                card.addEventListener('click', () => {
                    const chNum = parseInt(card.dataset.chapter);
                    showChapterVerses(chNum);
                });
            });
        }

        // Show verses for a chapter
        function showChapterVerses(chapterNum) {
            const chapter = GITA_DATA.chapters.find(c => c.chapter === chapterNum);
            if (!chapter) return;

            versesContentEl.innerHTML = `
                <h3 style="margin-bottom: 16px; color: var(--md-sys-color-primary);">
                    Chapter ${chapter.chapter}: ${chapter.titleEnglish}
                </h3>
                ${chapter.verses.map(verse => renderVerseCard(verse)).join('')}
            `;

            chaptersListEl.style.display = 'none';
            document.getElementById('daily-wisdom').style.display = 'none';
            versesListEl.classList.add('active');
            lucide.createIcons();
        }

        // Render single verse card
        function renderVerseCard(verse) {
            return `
                <div class="verse-item">
                    <div class="verse-ref">üìñ Verse ${verse.ref}</div>
                    <div class="verse-sanskrit-text">${verse.sanskrit}</div>
                    <div class="verse-translation-text">"${verse.translation}"</div>
                    <div class="verse-explanation">${verse.explanation}</div>
                    <div class="verse-themes">
                        ${verse.themes.map(t => `<span class="theme-tag">${t}</span>`).join('')}
                    </div>
                </div>
            `;
        }

        // Back to chapters
        backBtn.addEventListener('click', () => {
            versesListEl.classList.remove('active');
            chaptersListEl.style.display = 'block';
            document.getElementById('daily-wisdom').style.display = 'block';
            searchResults.style.display = 'none';
        });

        // Search functionality
        let searchTimeout;
        searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            const query = e.target.value.trim();

            if (query.length < 2) {
                searchResults.style.display = 'none';
                chaptersListEl.style.display = 'block';
                return;
            }

            searchTimeout = setTimeout(() => {
                const results = GITA_DATA.search(query);

                if (results.length > 0) {
                    searchResults.innerHTML = `
                        <p style="margin-bottom: 16px; color: var(--text-secondary);">
                            Found ${results.length} verse${results.length > 1 ? 's' : ''} for "${query}"
                        </p>
                        ${results.map(v => renderVerseCard(v)).join('')}
                    `;
                    searchResults.style.display = 'block';
                    chaptersListEl.style.display = 'none';
                    versesListEl.classList.remove('active');
                    document.getElementById('daily-wisdom').style.display = 'none';
                } else {
                    searchResults.innerHTML = `
                        <div class="empty-state">
                            <i data-lucide="search-x"></i>
                            <p>No verses found for "${query}"</p>
                        </div>
                    `;
                    searchResults.style.display = 'block';
                    chaptersListEl.style.display = 'none';
                }
                lucide.createIcons();
            }, 300);
        });

        // Tab switching
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                const view = tab.dataset.view;
                if (view === 'chapters') {
                    renderChapters();
                } else if (view === 'favorites') {
                    chaptersListEl.innerHTML = `
                        <div class="empty-state">
                            <i data-lucide="heart"></i>
                            <p>No favorite verses yet</p>
                            <p style="font-size: 0.85rem; margin-top: 8px;">Tap ‚ù§Ô∏è on any verse to add to favorites</p>
                        </div>
                    `;
                    lucide.createIcons();
                }
            });
        });

        // Initialize
        showDailyWisdom();
        renderChapters();
    </script>
</body>

</html>